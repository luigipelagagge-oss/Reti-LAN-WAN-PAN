<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Lab 2: Client/Server</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 40px; background-color: #f8f9fa; }
        .lab-container { max-width: 900px; margin: 0 auto; background: white; padding: 40px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .code-box { background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 0.9em; height: 100%;}
        
        /* Stile per lo schema SVG */
        .diagram-container {
            text-align: center;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="lab-container">
        <a href="index.html" class="btn btn-outline-secondary mb-3">&larr; Torna alla Home</a>
        
        <h1 class="text-success mb-4">Esperimento 2: Sender & Receiver</h1>
        
        <p class="lead">Per risolvere il caos del primo esperimento, introduciamo i <strong>Ruoli</strong>.</p>

        <div class="row align-items-center mb-5">
            <div class="col-md-7">
                <div class="diagram-container">
                    <svg width="100%" height="200" viewBox="0 0 500 220" style="background-color: #fff; border: 1px solid #ddd; border-radius: 8px;">
                        <rect x="20" y="40" width="120" height="140" rx="5" fill="#008CBA" opacity="0.1" stroke="#008CBA" stroke-width="2"/>
                        <text x="80" y="30" font-family="Arial" font-weight="bold" fill="#008CBA" text-anchor="middle">SENDER</text>
                        <text x="30" y="70" font-family="monospace" font-size="14">TX --&gt;</text>
                        <text x="30" y="100" font-family="monospace" font-size="14">RX &lt;--</text>
                        <text x="30" y="150" font-family="monospace" font-size="14">GND ---</text>

                        <rect x="360" y="40" width="120" height="140" rx="5" fill="#28a745" opacity="0.1" stroke="#28a745" stroke-width="2"/>
                        <text x="420" y="30" font-family="Arial" font-weight="bold" fill="#28a745" text-anchor="middle">RECEIVER</text>
                        <text x="420" y="70" font-family="monospace" font-size="14">&lt;-- RX</text>
                        <text x="420" y="100" font-family="monospace" font-size="14">--&gt; TX</text>
                        <text x="420" y="150" font-family="monospace" font-size="14">--- GND</text>

                        <path d="M 80 65 L 200 65 L 300 95 L 410 70" stroke="#d63384" stroke-width="3" fill="none" marker-end="url(#arrow)" />
                        
                        <path d="M 80 95 L 200 95 L 300 65 L 410 100" stroke="#6c757d" stroke-width="2" stroke-dasharray="5,5" fill="none" opacity="0.5" />

                        <path d="M 80 145 L 410 145" stroke="black" stroke-width="3" fill="none" />

                        <rect x="180" y="55" width="140" height="20" fill="white" stroke="none"/>
                        <text x="250" y="70" font-family="Arial" font-size="12" fill="#d63384" text-anchor="middle" font-weight="bold">DATI (TX &rarr; RX)</text>
                        
                        <rect x="220" y="135" width="60" height="20" fill="white" stroke="none"/>
                        <text x="250" y="150" font-family="Arial" font-size="12" fill="black" text-anchor="middle">GND</text>
                        
                        <defs>
                            <marker id="arrow" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto" markerUnits="strokeWidth">
                                <path d="M0,0 L0,6 L9,3 z" fill="#d63384" />
                            </marker>
                        </defs>
                    </svg>
                </div>
            </div>
            
            <div class="col-md-5">
                <div class="alert alert-success">
                    <strong>Concetto Chiave:</strong>
                    <ul>
                        <li><strong>Sender (Client):</strong> La "bocca". Invia i dati tramite il pin TX.</li>
                        <li><strong>Receiver (Server):</strong> L'"orecchio". Ascolta tramite il pin RX.</li>
                        <li><strong>Incrocio (Crossover):</strong> Nota come il cavo rosa vada dal TX di sinistra all'RX di destra. Se colleghi TX con TX non funziona!</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <h5 class="text-primary">Codice A: Sender</h5>
                <div class="code-box">
void setup() {
  Serial.begin(9600);
}

void loop() {
  // Invia un messaggio ogni secondo
  Serial.println("Ciao!");
  delay(1000);
}
                </div>
            </div>
            <div class="col-md-6">
                <h5 class="text-success">Codice B: Receiver</h5>
                <div class="code-box">
void setup() {
  Serial.begin(9600);
  pinMode(13, OUTPUT);
}

void loop() {
  // Ascolta: C'Ã¨ posta per me?
  if (Serial.available() > 0) {
    // Leggi e svuota il buffer
    String msg = Serial.readString();
    
    // Feedback Visivo
    digitalWrite(13, HIGH);
    delay(200);
    digitalWrite(13, LOW);
  }
}
                </div>
            </div>
        </div>

        <div class="mt-5 p-4 bg-light rounded border">
            <h4>ðŸ§ª Cosa fare ora:</h4>
            <ol>
                <li>Torna su Tinkercad.</li>
                <li>Modifica il codice dell'Arduino sinistro con il codice <strong>Sender</strong>.</li>
                <li>Modifica il codice dell'Arduino destro con il codice <strong>Receiver</strong>.</li>
                <li>Avvia: vedrai che il LED di destra lampeggia <em>esattamente</em> a ritmo col messaggio inviato da sinistra!</li>
            </ol>
        </div>
    </div>
</body>
</html>
