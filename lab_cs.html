<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Lab 2: Client-Server</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 40px; background-color: #f8f9fa; }
        .lab-container { max-width: 900px; margin: 0 auto; background: white; padding: 40px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .code-box { background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 5px; font-family: 'Consolas', monospace; font-size: 0.9em; overflow-x: auto; margin-bottom: 20px;}
        .comment { color: #6a9955; }
        .keyword { color: #569cd6; }
        .string { color: #ce9178; }
    </style>
</head>
<body>
    <div class="lab-container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <a href="index.html" class="btn btn-outline-secondary">&larr; Indietro (Lab 1)</a>
            <span class="badge bg-warning text-dark">Protocollo Seriale</span>
        </div>
        
        <h1 class="text-primary mb-3">Esperimento 2: Botta e Risposta</h1>
        
        <div class="alert alert-success">
            <strong>Obiettivo:</strong> Risolvere il caos del Lab 1. Arduino A invia un comando ("ciao"), Arduino B lo riceve, lo elabora e risponde solo quando interrogato.
        </div>

        

[Image of client server communication diagram]


        <div class="row">
            <div class="col-md-6">
                <h4 class="text-danger">Arduino A (Sender)</h4>
                <p>Invia un saluto ogni 2 secondi e aspetta.</p>
                <div class="code-box">
<span class="keyword">void</span> setup() {<br>
&nbsp;&nbsp;Serial.begin(9600);<br>
}<br><br>
<span class="keyword">void</span> loop() {<br>
&nbsp;&nbsp;<span class="comment">// Invia il messaggio con accapo</span><br>
&nbsp;&nbsp;Serial.println(<span class="string">"ciao"</span>);<br>
&nbsp;&nbsp;delay(2000);<br>
}
                </div>
            </div>

            <div class="col-md-6">
                <h4 class="text-success">Arduino B (Receiver)</h4>
                <p>Ascolta, conta quante volte Ã¨ stato salutato e risponde.</p>
                <div class="code-box">
<span class="keyword">int</span> contatore = 0;<br><br>
<span class="keyword">void</span> setup() {<br>
&nbsp;&nbsp;Serial.begin(9600);<br>
&nbsp;&nbsp;pinMode(13, OUTPUT);<br>
}<br><br>
<span class="keyword">void</span> loop() {<br>
&nbsp;&nbsp;<span class="comment">// 1. Controllo se c'Ã¨ posta (Buffer)</span><br>
&nbsp;&nbsp;<span class="keyword">if</span> (Serial.available() > 0) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">String</span> msg = Serial.readStringUntil(<span class="string">'\n'</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;msg.trim(); <span class="comment">// Pulisce spazi vuoti</span><br><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> (msg == <span class="string">"ciao"</span>) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contatore++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// Feedback Visivo</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;digitalWrite(13, HIGH); delay(100); digitalWrite(13, LOW);<br><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// Logica Risposta</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> (contatore < 10) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Serial.print(<span class="string">"Grazie del messaggio "</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Serial.println(contatore);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <span class="keyword">else if</span> (contatore == 10) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Serial.println(<span class="string">"Ho capito"</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;}<br>
}
                </div>
            </div>
        </div>

        <div class="text-center my-4">
            <a href="https://www.tinkercad.com/things/363ul1V5EKu-collegamentoseriale2pingpong?sharecode=RrlQjYR765f2VDB7F_MYtOOU_XZL_Y551m5zwoAZ9rE" target="_blank" class="btn btn-warning btn-lg fw-bold px-5 shadow">
                ðŸš€ Avvia Simulazione Lab 2
            </a>
        </div>

        <div class="card bg-light border-primary mt-4">
            <div class="card-body">
                <h5 class="card-title">ðŸ’¡ Cosa abbiamo imparato?</h5>
                <p>A differenza del Lab 1, qui usiamo <code>Serial.available()</code>. Arduino B non legge "a caso", ma controlla se nel buffer Ã¨ arrivato qualcosa. Inoltre usiamo <code>Serial.readStringUntil('\n')</code> per sincronizzare la comunicazione.</p>
            </div>
        </div>

        <div class="text-end mt-4">
            <a href="lab_i2c.html" class="btn btn-success btn-lg">Vai al Lab 3: Controllo Temperatura &raquo;</a>
        </div>
    </div>
</body>
</html>
